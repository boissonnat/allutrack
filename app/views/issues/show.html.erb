<%- model_class = Issue -%>
<% content_for :title, "Issue" + @issue.title %>
<div class="row">
  <div class="col-md-12">
    <ol class="breadcrumb">
      <li><%=link_to @issue.project.title, project_path(@issue.project)%></li>
      <li><%=link_to @issue.milestone.title, milestone_path(@issue.milestone)%></li>
      <li class="active"><%=@issue.title%></li>
    </ol>
  </div>
</div>

<div class="row">
  <div class="col-md-11">
    <div class="panel panel-success">
      <div class="panel-heading">
        <div class="pull-right">
          <% if can? :update, @issue %>
              <%=link_to edit_issue_path(@issue) do %>
                  <i class="glyphicon glyphicon-edit"></i>
              <%end%>
          <%end%>

          <% if can? :destroy, @issue %>
              <%= link_to issue_path(@issue),
                          :method => 'delete',
                          :data => { :confirm => t('helpers.actions.confirm') },
                          :class => 'btn btn-link' do %>
                  <i class="glyphicon glyphicon-trash"></i>
              <%end %>
          <%end%>
        </div>

        <h3 class="panel-title">
          <%=@issue.title%><br/>
          <small>Opened by <b><%=@issue.user.username%></b>, the <%=l @issue.created_at, format: :usual_date%></small>
        </h3>
      </div>
      <div class="panel-body">
        <%=@issue.body%>
      </div>
    </div>


    <% @issue.comments.each do |comment| %>
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">
              <small>Commented by <b><%=comment.user.username%></b>, the <%=l @issue.created_at, format: :usual_date%></small>
            </h3>
          </div>
          <div class="panel-body">
            <%=comment.body%>
          </div>
        </div>
    <%end%>

    <%= form_for([@issue, @issue.comments.build]) do |f| %>
        <div class="form-group">
          <%= f.text_area :body, :class => 'form-control', :placeholder => 'Add your comment here' %>
        </div>

        <div class="form-group pull-right">
          <%= f.submit 'Post', :class => 'btn btn-default' %>
          <% if @issue.status == STATUS[0]%>
              <%=link_to 'Close', close_issue_path(@issue), :class => 'btn btn-danger'%>
          <%else%>
              <%=link_to 'Reopen', reopen_issue_path(@issue), :class => 'btn btn-success'%>
          <%end%>

        </div>
    <% end %>
  </div>

  <div class="col-md-1">
    <div class="row">
      <div class="col-md-12">
        <%if @issue.status == STATUS[0]%>
            <span style="padding: 7px 0;" class="label label-success center-block">OPEN</span>
        <%else%>
            <span style="padding: 7px 0;" class="label label-danger center-block">CLOSED</span>
        <%end%>
        <p class="text-center"><small><b><%=@issue.comments.count%></b> comments</small></p>
        <hr/>
        <b>Labels</b><br/>
        <%@issue.tag_list.each do |tag|%>
            <%= tag %>
        <% end %>
        <br/>
        <b>Milestone</b>
        <%=link_to @issue.milestone.title, milestone_path(@issue.milestone)%>
      </div>
    </div>
  </div>
</div>


