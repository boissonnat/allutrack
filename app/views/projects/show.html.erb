<%- model_class = Project -%>
<% content_for :title, " Project " + @project.title %>

<div class="row">
  <div class="col-md-12">
    <ol class="breadcrumb">
      <li><%=link_to @project.author.username, user_path(@project.author)%></li>
      <li class="active"><%=@project.title%></li>
    </ol>
  </div>
</div>

<div class="row">
  <div class="col-md-9">
    <div class="row">
      <div class="col-md-12">
        <%= render 'issues/collection' %>
        <%= link_to t('helpers.actions.new_object', message:'Issue'), new_issue_path(:project_id => @project.id), :class => 'btn btn-default pull-right' %>
      </div>
    </div>
    <div style="padding-top: 40px" class="row">
      <div class="col-md-12">
        <div class="panel panel-default">
          <div class="panel-heading">Description</div>
          <div class="panel-body">
            <%= markdown(@project.text) %>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Overview-->
  <div class="col-md-3">
    <div class="row">
      <div class="col-md-12">
        <div class="panel panel-default">
          <div class="panel-heading">
            <% if can? :update, @project %>
                <div class="btn-group pull-right">
                  <button style="margin-top: -7px" type="button" class="btn btn-link dropdown-toggle" data-toggle="dropdown">
                    <i class="glyphicon glyphicon-cog"></i>
                  </button>
                  <ul class="dropdown-menu" role="menu">

                    <li><%= link_to t('helpers.actions.edit'), edit_project_path(@project) %></li>
                    <li><%= link_to t('helpers.actions.delete'),
                                    project_path(@project),
                                    :method => 'delete',
                                    :data => { :confirm => t('helpers.actions.confirm') }%></li>

                  </ul>
                </div>
            <%end%>
            <%=@project.title%>
          </div>
          <div class="panel-body">
            <ul class="list-unstyled">
              <li><b><%=@project.issues.count%></b> issues</li>
              <li><b><%=@project.milestones.count%></b> milestones</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Milestones -->
    <div class="row">
      <div class="col-md-12">
        <div class="panel panel-default">
          <div class="panel-heading">
            <%=link_to new_milestone_path(:project_id => @project.id), :class => 'btn btn-link pull-right', :style => 'margin-top: -7px' do%>
                <i class="glyphicon glyphicon-plus"></i>
            <%end%>
            Milestones
          </div>
          <div class="panel-body">
            <ul class="list-unstyled">
              <%@project.milestones.each do |milestone|%>
                  <%
                     issues = milestone.issues
                     closed_issues = Issue.where(status: STATUS[1], milestone_id: milestone.id)
                     progress = 0
                     if closed_issues.count > 0
                        progress = (closed_issues.count * 100) / issues.count
                     end
                  %>
                  <li>
                    <b><%=link_to milestone.title, milestone_path(milestone)%></b><small> (<%=l milestone.dueTo, format: :usual_date%>)</small>
                    <div class="progress">
                      <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: <%=progress%>%;">
                        <span class="sr-only"><%=progress%>% Complete</span>
                      </div>
                    </div>
                  </li>
              <% end %>

            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Contributors -->
    <div class="row">
      <div class="col-md-12">
        <div class="panel panel-default">
          <div class="panel-heading">
            <% if can? :add_contributor, @project %>
                <%=link_to add_contributor_project_path(@project), :class => 'btn btn-link pull-right', :style => 'margin-top: -7px' do%>
                    <i class="glyphicon glyphicon-plus"></i>
                <%end%>
            <%end%>
            Contributors
          </div>
          <div class="panel-body">
            <ul class="list-unstyled">
              <%@project.contributors.each do |contributor|%>
                  <li><b><%=link_to contributor.username, user_path(contributor)%></b></li>
              <% end %>

            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>