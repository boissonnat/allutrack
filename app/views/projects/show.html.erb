<%- model_class = Project -%>
<div class="row">
  <div class="col-md-12">
    <ol class="breadcrumb">
      <li><%=link_to @project.user.email, user_path(@project.user)%></li>
      <li class="active"><%=@project.title%></li>
    </ol>
  </div>
</div>

<div class="row">
  <div class="col-md-9">
    <div class="row">
      <div class="col-md-12">
        <%= render 'issues/collection' %>
        <%= link_to t('helpers.actions.new_object', message:'Issue'), new_issue_path(:project_id => @project.id), :class => 'btn btn-default pull-right' %>
      </div>
    </div>
    <div style="padding-top: 40px" class="row">
      <div class="col-md-12">
        <div class="panel panel-default">
          <div class="panel-heading">Description</div>
          <div class="panel-body">
            <%= @project.text %>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-md-3">
    <div class="row">
      <div class="col-md-12">
        <div class="panel panel-default">
          <div class="panel-heading">
            <div class="btn-group pull-right">
              <button style="margin-top: -7px" type="button" class="btn btn-link dropdown-toggle" data-toggle="dropdown">
                <i class="glyphicon glyphicon-cog"></i>
              </button>
              <ul class="dropdown-menu" role="menu">
                <li><%= link_to t('helpers.actions.edit'), edit_project_path(@project) %></li>
                <li><%= link_to t('helpers.actions.delete'),
                                project_path(@project),
                                :method => 'delete',
                                :data => { :confirm => t('helpers.actions.confirm') }%></li>
              </ul>
            </div>
            <%=@project.title%>
          </div>
          <div class="panel-body">
            <ul class="list-unstyled">
              <li><b><%=@project.issues.count%></b> issues</li>
              <li><b><%=@project.milestones.count%></b> milestones</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-md-12">
        <div class="panel panel-default">
          <div class="panel-heading">
            <%=link_to new_milestone_path(:project_id => @project.id), :class => 'btn btn-link pull-right', :style => 'margin-top: -7px' do%>
                <i class="glyphicon glyphicon-plus"></i>
            <%end%>
            Milestones
          </div>
          <div class="panel-body">
            <ul class="list-unstyled">
              <%@project.milestones.each do |milestone|%>
                  <%
                     issues = milestone.issues
                     closed_issues = Issue.where(status: STATUS[1], milestone_id: milestone.id)
                     progress = (closed_issues.count * 100) / issues.count
                  %>
                  <li>
                    <b><%=link_to milestone.title, milestone_path(milestone)%></b><small> (<%=l milestone.dueTo, format: :usual_date%>)</small>
                    <div class="progress">
                      <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: <%=progress%>%;">
                        <span class="sr-only"><%=progress%>% Complete</span>
                      </div>
                    </div>
                  </li>
              <% end %>

            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>